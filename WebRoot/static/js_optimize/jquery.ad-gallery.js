(function(G){G.fn.adGallery=function(J){var L={loader_image:"loader.gif",start_at_index:0,description_wrapper:false,thumb_opacity:0.7,animate_first_image:false,animation_speed:400,width:false,height:false,display_next_and_prev:true,display_back_and_forward:true,scroll_jump:0,slideshow:{enable:true,autostart:false,speed:3000,start_label:"Start",stop_label:"Stop",stop_on_scroll:true,countdown_prefix:"(",countdown_sufix:")",onStart:false,onStop:false},effect:"slide-hori",enable_keyboard_move:true,cycle:true,callbacks:{init:false,afterImageVisible:false,beforeImageVisible:false}};var K=G.extend(false,L,J);if(J&&J.slideshow){K.slideshow=G.extend(false,L.slideshow,J.slideshow)}if(!K.slideshow.enable){K.slideshow.autostart=false}var I=[];G(this).each(function(){var M=new C(this,K);I[I.length]=M});return I};function F(J,K,L){var M=parseInt(J.css("top"),10);if(K=="left"){var I="-"+this.image_wrapper_height+"px";J.css("top",this.image_wrapper_height+"px")}else{var I=this.image_wrapper_height+"px";J.css("top","-"+this.image_wrapper_height+"px")}if(L){L.css("bottom","-"+L[0].offsetHeight+"px");L.animate({bottom:0},this.settings.animation_speed*2)}if(this.current_description){this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2)}return{old_image:{top:I},new_image:{top:M}}}function E(J,K,M){var L=parseInt(J.css("left"),10);if(K=="left"){var I="-"+this.image_wrapper_width+"px";J.css("left",this.image_wrapper_width+"px")}else{var I=this.image_wrapper_width+"px";J.css("left","-"+this.image_wrapper_width+"px")}if(M){M.css("bottom","-"+M[0].offsetHeight+"px");M.animate({bottom:0},this.settings.animation_speed*2)}if(this.current_description){this.current_description.animate({bottom:"-"+this.current_description[0].offsetHeight+"px"},this.settings.animation_speed*2)}return{old_image:{left:I},new_image:{left:L}}}function D(K,L,N){var J=K.width();var I=K.height();var M=parseInt(K.css("left"),10);var O=parseInt(K.css("top"),10);K.css({width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2});return{old_image:{width:0,height:0,top:this.image_wrapper_height/2,left:this.image_wrapper_width/2},new_image:{width:J,height:I,top:O,left:M}}}function B(I,J,K){I.css("opacity",0);return{old_image:{opacity:0},new_image:{opacity:1}}}function H(I,J,K){I.css("opacity",0);return{old_image:{opacity:0},new_image:{opacity:1},speed:0}}function C(J,I){this.init(J,I)}C.prototype={wrapper:false,image_wrapper:false,gallery_info:false,nav:false,loader:false,preloads:false,thumbs_wrapper:false,scroll_back:false,scroll_forward:false,next_link:false,prev_link:false,slideshow:false,image_wrapper_width:0,image_wrapper_height:0,current_index:0,current_image:false,current_description:false,nav_display_width:0,settings:false,images:false,in_transition:false,animations:false,init:function(M,L){var K=this;this.wrapper=G(M);this.settings=L;this.setupElements();this.setupAnimations();if(this.settings.width){this.image_wrapper_width=this.settings.width;this.image_wrapper.width(this.settings.width);this.wrapper.width(this.settings.width)}else{this.image_wrapper_width=this.image_wrapper.width()}if(this.settings.height){this.image_wrapper_height=this.settings.height;this.image_wrapper.height(this.settings.height)}else{this.image_wrapper_height=this.image_wrapper.height()}this.nav_display_width=this.nav.width();this.current_index=0;this.current_image=false;this.current_description=false;this.in_transition=false;this.findImages();if(this.settings.display_next_and_prev){this.initNextAndPrev()}var I=function(N){return K.nextImage(N)};this.slideshow=new A(I,this.settings.slideshow);this.controls.append(this.slideshow.create());if(this.settings.slideshow.enable){this.slideshow.enable()}else{this.slideshow.disable()}if(this.settings.display_back_and_forward){this.initBackAndForward()}if(this.settings.enable_keyboard_move){this.initKeyEvents()}var J=parseInt(this.settings.start_at_index,10);if(window.location.hash&&window.location.hash.indexOf("#ad-image")===0){J=window.location.hash.replace(/[^0-9]+/g,"");if((J*1)!=J){J=this.settings.start_at_index}}this.loading(true);this.showImage(J,function(){if(K.settings.slideshow.autostart){K.preloadImage(J+1);K.slideshow.start()}});this.fireCallback(this.settings.callbacks.init)},setupAnimations:function(){this.animations={"slide-vert":F,"slide-hori":E,resize:D,fade:B,none:H}},setupElements:function(){this.controls=this.wrapper.find(".ad-controls");this.gallery_info=G('<p class="ad-info"></p>');this.controls.append(this.gallery_info);this.image_wrapper=this.wrapper.find(".ad-image-wrapper");this.image_wrapper.empty();this.nav=this.wrapper.find(".ad-nav");this.thumbs_wrapper=this.nav.find(".ad-thumbs");this.preloads=G('<div class="ad-preloads"></div>');this.loader=G('<img class="ad-loader" src="'+this.settings.loader_image+'">');this.image_wrapper.append(this.loader);this.loader.hide();G(document.body).append(this.preloads)},loading:function(I){if(I){this.loader.show()}else{this.loader.hide()}},addAnimation:function(I,J){if(G.isFunction(J)){this.animations[I]=J}},findImages:function(){var N=this;this.images=[];var M=0;var L=0;var K=this.thumbs_wrapper.find("a");var J=K.length;if(this.settings.thumb_opacity<1){K.find("img").css("opacity",this.settings.thumb_opacity)}K.each(function(P){var R=G(this);var Q=R.attr("href");var O=R.find("img");if(!N.isImageLoaded(O[0])){O.load(function(){M+=this.parentNode.parentNode.offsetWidth;L++})}else{M+=O[0].parentNode.parentNode.offsetWidth;L++}R.addClass("ad-thumb"+P);R.click(function(){N.showImage(P);N.slideshow.stop();return false}).hover(function(){if(!G(this).is(".ad-active")&&N.settings.thumb_opacity<1){G(this).find("img").fadeTo(300,1)}N.preloadImage(P)},function(){if(!G(this).is(".ad-active")&&N.settings.thumb_opacity<1){G(this).find("img").fadeTo(300,N.settings.thumb_opacity)}});var R=false;if(O.data("ad-link")){R=O.data("ad-link")}else{if(O.attr("longdesc")&&O.attr("longdesc").length){R=O.attr("longdesc")}}var T=false;if(O.data("ad-desc")){T=O.data("ad-desc")}else{if(O.attr("alt")&&O.attr("alt").length){T=O.attr("alt")}}var S=false;if(O.data("ad-title")){S=O.data("ad-title")}else{if(O.attr("title")&&O.attr("title").length){S=O.attr("title")}}N.images[P]={thumb:O.attr("src"),image:Q,error:false,preloaded:false,desc:T,title:S,size:false,link:R}});var I=setInterval(function(){if(J==L){M-=100;var Q=N.nav.find(".ad-thumb-list");Q.css("width",M+"px");var P=1;var O=Q.height();while(P<201){Q.css("width",(M+P)+"px");if(O!=Q.height()){break}O=Q.height();P++}clearInterval(I)}},100)},initKeyEvents:function(){var I=this;G(document).keydown(function(J){if(J.keyCode==39){I.nextImage();I.slideshow.stop()}else{if(J.keyCode==37){I.prevImage();I.slideshow.stop()}}})},initNextAndPrev:function(){this.next_link=G('<div class="ad-text"><h2 class="ad-text-title">Series</h2><p>Jewelry Name</p><p>aaaaaaaa</p><p>aaaaaaaaaaaa</p><br><h2 class="ad-text-title">故事</h2><p>创作故事故事故事故事故事故事故事故事故事故<br>事故事故事故事故事故事故事故事故事故事故事故事故事故事故事故事</p><br> <p>产品尺寸</p> <p>产品材质</p> <p>制作工期</p><br><p>aaaaaa</p><p>aaaaaa</p><p>aaaaaa</p></div></div><div class="ad-next"><div class="ad-next-image"></div></div>');this.prev_link=G('<div class="ad-prev"><div class="ad-prev-image"></div></div>');this.image_wrapper.append(this.next_link);this.image_wrapper.append(this.prev_link);var I=this;this.prev_link.add(this.next_link).mouseover(function(J){G(this).css("height",I.image_wrapper_height);G(this).find("div").show()}).mouseout(function(J){G(this).find("div").hide()}).click(function(){if(G(this).is(".ad-next")){I.nextImage();I.slideshow.stop()}else{I.prevImage();I.slideshow.stop()}}).find("div").css("opacity",0.7)},initBackAndForward:function(){var K=this;this.scroll_forward=G('<div class="ad-forward"></div>');this.scroll_back=G('<div class="ad-back"></div>');this.nav.append(this.scroll_forward);this.nav.prepend(this.scroll_back);var J=0;var I=false;G(this.scroll_back).add(this.scroll_forward).click(function(){var L=K.nav_display_width-50;if(K.settings.scroll_jump>0){var L=K.settings.scroll_jump}if(G(this).is(".ad-forward")){var M=K.thumbs_wrapper.scrollLeft()+L}else{var M=K.thumbs_wrapper.scrollLeft()-L}if(K.settings.slideshow.stop_on_scroll){K.slideshow.stop()}K.thumbs_wrapper.animate({scrollLeft:M+"px"});return false}).css("opacity",0.6).hover(function(){var L="left";if(G(this).is(".ad-forward")){L="right"}I=setInterval(function(){J++;if(J>30&&K.settings.slideshow.stop_on_scroll){K.slideshow.stop()}var M=K.thumbs_wrapper.scrollLeft()+1;if(L=="left"){M=K.thumbs_wrapper.scrollLeft()-1}K.thumbs_wrapper.scrollLeft(M)},10);G(this).css("opacity",1)},function(){J=0;clearInterval(I);G(this).css("opacity",0.6)})},_afterShow:function(){this.gallery_info.html((this.current_index+1)+" / "+this.images.length);if(!this.settings.cycle){this.prev_link.show().css("height",this.image_wrapper_height);this.next_link.show().css("height",this.image_wrapper_height);if(this.current_index==(this.images.length-1)){this.next_link.hide()}if(this.current_index==0){this.prev_link.hide()}}this.fireCallback(this.settings.callbacks.afterImageVisible)},_getContainedImageSize:function(J,I){if(I>this.image_wrapper_height){var K=J/I;I=this.image_wrapper_height;J=this.image_wrapper_height*K}if(J>this.image_wrapper_width){var K=I/J;J=this.image_wrapper_width;I=this.image_wrapper_width*K}return{width:J,height:I}},_centerImage:function(L,J,I){L.css("top","0px");if(I<this.image_wrapper_height){var K=this.image_wrapper_height-I;L.css("top",(K/2)+"px")}L.css("left","0px");if(J<this.image_wrapper_width){var K=this.image_wrapper_width-J;L.css("left",(K/2)+"px")}},_getDescription:function(I){var K=false;if(I.desc.length||I.title.length){var J="";if(I.title.length){J='<strong class="ad-description-title">'+I.title+"</strong>"}var K="";if(I.desc.length){K="<span>"+I.desc+"</span>"}K=G('<p class="ad-image-description">'+J+K+"</p>")}return K},showImage:function(I,L){if(this.images[I]&&!this.in_transition){var J=this;var K=this.images[I];this.in_transition=true;if(!K.preloaded){this.loading(true);this.preloadImage(I,function(){J.loading(false);J._showWhenLoaded(I,L)})}else{this._showWhenLoaded(I,L)}}},_showWhenLoaded:function(Q,W){if(this.images[Q]){var J=this;var L=this.images[Q];var M=G(document.createElement("div")).addClass("ad-image");var O=G(new Image()).attr("src",L.image);if(L.link){var T=G('<a href="'+L.link+'" target="_blank"></a>');T.append(O);M.append(T)}else{M.append(O)}this.image_wrapper.prepend(M);var X=this._getContainedImageSize(L.size.width,L.size.height);O.attr("width",X.width);O.attr("height",X.height);M.css({width:X.width+"px",height:X.height+"px"});this._centerImage(M,X.width,X.height);var P=this._getDescription(L,M);if(P){if(!this.settings.description_wrapper){M.append(P);var I=X.width-parseInt(P.css("padding-left"),10)-parseInt(P.css("padding-right"),10);P.css("width",I+"px")}else{this.settings.description_wrapper.append(P)}}this.highLightThumb(this.nav.find(".ad-thumb"+Q));var U="right";if(this.current_index<Q){U="left"}this.fireCallback(this.settings.callbacks.beforeImageVisible);if(this.current_image||this.settings.animate_first_image){var V=this.settings.animation_speed;var S="swing";var N=this.animations[this.settings.effect].call(this,M,U,P);if(typeof N.speed!="undefined"){V=N.speed}if(typeof N.easing!="undefined"){S=N.easing}if(this.current_image){var K=this.current_image;var R=this.current_description;K.animate(N.old_image,V,S,function(){K.remove();if(R){R.remove()}})}M.animate(N.new_image,V,S,function(){J.current_index=Q;J.current_image=M;J.current_description=P;J.in_transition=false;J._afterShow();J.fireCallback(W)})}else{this.current_index=Q;this.current_image=M;J.current_description=P;this.in_transition=false;J._afterShow();this.fireCallback(W)}}},nextIndex:function(){if(this.current_index==(this.images.length-1)){if(!this.settings.cycle){return false}var I=0}else{var I=this.current_index+1}return I},nextImage:function(J){var I=this.nextIndex();if(I===false){return false}this.preloadImage(I+1);this.showImage(I,J);return true},prevIndex:function(){if(this.current_index==0){if(!this.settings.cycle){return false}var I=this.images.length-1}else{var I=this.current_index-1}return I},prevImage:function(J){var I=this.prevIndex();if(I===false){return false}this.preloadImage(I-1);this.showImage(I,J);return true},preloadAll:function(){var J=this;var I=0;function K(){if(I<J.images.length){I++;J.preloadImage(I,K)}}J.preloadImage(I,K)},preloadImage:function(J,M){if(this.images[J]){var L=this.images[J];if(!this.images[J].preloaded){var I=G(new Image());I.attr("src",L.image);if(!this.isImageLoaded(I[0])){this.preloads.append(I);var K=this;I.load(function(){L.preloaded=true;L.size={width:this.width,height:this.height};K.fireCallback(M)}).error(function(){L.error=true;L.preloaded=false;L.size=false})}else{L.preloaded=true;L.size={width:I[0].width,height:I[0].height};this.fireCallback(M)}}else{this.fireCallback(M)}}},isImageLoaded:function(I){if(typeof I.complete!="undefined"&&!I.complete){return false}if(typeof I.naturalWidth!="undefined"&&I.naturalWidth==0){return false}return true},highLightThumb:function(I){this.thumbs_wrapper.find(".ad-active").removeClass("ad-active");I.addClass("ad-active");if(this.settings.thumb_opacity<1){this.thumbs_wrapper.find("a:not(.ad-active) img").fadeTo(300,this.settings.thumb_opacity);I.find("img").fadeTo(300,1)}var J=I[0].parentNode.offsetLeft;J-=(this.nav_display_width/2)-(I[0].offsetWidth/2);this.thumbs_wrapper.animate({scrollLeft:J+"px"})},fireCallback:function(I){if(G.isFunction(I)){I.call(this)}}};function A(I,J){this.init(I,J)}A.prototype={start_link:false,stop_link:false,countdown:false,controls:false,settings:false,nextimage_callback:false,enabled:false,running:false,countdown_interval:false,init:function(I,K){var J=this;this.nextimage_callback=I;this.settings=K},create:function(){this.start_link=G('<span class="ad-slideshow-start">'+this.settings.start_label+"</span>");this.stop_link=G('<span class="ad-slideshow-stop">'+this.settings.stop_label+"</span>");this.countdown=G('<span class="ad-slideshow-countdown"></span>');this.controls=G('<div class="ad-slideshow-controls"></div>');this.controls.append(this.start_link).append(this.stop_link).append(this.countdown);this.countdown.hide();var I=this;this.start_link.click(function(){I.start()});this.stop_link.click(function(){I.stop()});G(document).keydown(function(J){if(J.keyCode==83){if(I.running){I.stop()}else{I.start()}}});return this.controls},disable:function(){this.enabled=false;this.stop();this.controls.hide()},enable:function(){this.enabled=true;this.controls.show()},toggle:function(){if(this.enabled){this.disable()}else{this.enable()}},start:function(){if(this.running||!this.enabled){return false}var I=this;this.running=true;this.controls.addClass("ad-slideshow-running");this._next();this.fireCallback(this.settings.onStart);return true},stop:function(){if(!this.running){return false}this.running=false;this.countdown.hide();this.controls.removeClass("ad-slideshow-running");clearInterval(this.countdown_interval);this.fireCallback(this.settings.onStop);return true},_next:function(){var K=this;var L=this.settings.countdown_prefix;var J=this.settings.countdown_sufix;clearInterval(K.countdown_interval);this.countdown.show().html(L+(this.settings.speed/1000)+J);var I=0;this.countdown_interval=setInterval(function(){I+=1000;if(I>=K.settings.speed){var N=function(){if(K.running){K._next()}I=0};if(!K.nextimage_callback(N)){K.stop()}I=0}var M=parseInt(K.countdown.text().replace(/[^0-9]/g,""),10);M--;if(M>0){K.countdown.html(L+M+J)}},1000)},fireCallback:function(I){if(G.isFunction(I)){I.call(this)}}}})(jQuery);